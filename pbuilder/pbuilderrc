# Codenames for Debian suites according to their alias. Update these when
# needed.
UNSTABLE_CODENAME="sid"
TESTING_CODENAME="jessie"
STABLE_CODENAME="wheezy"
OLDSTABLE_CODENAME="squeeze"
OLDSTABLE_BACKPORTS_SUITE="$OLDSTABLE_CODENAME-backports"

# List of Debian suites.
DEBIAN_SUITES=($UNSTABLE_CODENAME $TESTING_CODENAME $STABLE_CODENAME $OLDSTABLE_CODENAME
    "unstable" "testing" "stable" "oldstable")

# List of Ubuntu suites. Update these when needed.
UBUNTU_SUITES=("utopic" "trusty" "saucy" "precise" "lucid")

# Mirrors to use. Update these to your preferred mirror.
DEBIAN_MIRROR="debian.osuosl.org"
DEBIAN_BACKPORTS_MIRROR=$DEBIAN_MIRROR
UBUNTU_MIRROR="ubuntu.osuosl.org"

# Optionally use the changelog of a package to determine the suite to use if
# none set.
if [ -z "${DIST}" ] && [ -r "debian/changelog" ]; then
    DIST=$(dpkg-parsechangelog | awk '/^Distribution: / {print $2}')
    # Use the unstable suite for Debian experimental packages.
    if [ "${DIST}" == "experimental" ]; then
        DIST="unstable"
    fi
fi


OTHERMIRROR="deb http://ci.tokarscy.com/deb $DIST main"

## Optionally set a default distribution if none is used. Note that you can set
## your own default (i.e. ${DIST:="unstable"}).
#: ${DIST:="$(lsb_release --short --codename)"}
#
## Optionally set the architecture to the host architecture if none set. Note
## that you can set your own default (i.e. ${ARCH:="i386"}).
#: ${ARCH:="$(dpkg --print-architecture)"}
#
#NAME="$DIST"
#if [ -n "${ARCH}" ]; then
#    NAME="$NAME-$ARCH"
#    DEBOOTSTRAPOPTS=("--arch" "$ARCH" "${DEBOOTSTRAPOPTS[@]}")
#fi
#
#BASETGZ="/var/cache/pbuilder/$NAME-base.tgz"
#DISTRIBUTION="$DIST"
#BUILDRESULT="/var/cache/pbuilder/$NAME/result/"
#APTCACHE="/var/cache/pbuilder/$NAME/aptcache/"
#BUILDPLACE="/var/cache/pbuilder/build/"
#
## make sure folders exist
#mkdir -p $BUILDRESULT
#mkdir -p $APTCACHE
#
#echo "Target : $BUILDRESULT" >>/tmp/dist
#
#if $(echo ${DEBIAN_SUITES[@]} | grep -q $DIST); then
#
##    OTHERMIRROR="deb file:///var/cache/pbuilder/$NAME/result ./"
#    BINDMOUNTS="/var/cache/pbuilder/$NAME/result"
#    HOOKDIR="/var/cache/pbuilder/$NAME/hooks"
#    EXTRAPACKAGES="apt-utils"
#    # Debian configuration
#    MIRRORSITE="http://$DEBIAN_MIRROR/debian/"
#    COMPONENTS="main contrib non-free"
#    DEBOOTSTRAPOPTS=("${DEBOOTSTRAPOPTS[@]}" "--keyring=/usr/share/keyrings/debian-archive-keyring.gpg")
#    if $(echo "$OLDSTABLE_CODENAME oldstable" | grep -q $DIST); then
##        EXTRAPACKAGES="$EXTRAPACKAGES debian-backports-keyring"
#    fi
#elif $(echo ${UBUNTU_SUITES[@]} | grep -q $DIST); then
#    # Ubuntu configuration
#    MIRRORSITE="http://$UBUNTU_MIRROR/ubuntu/"
#    COMPONENTS="main restricted universe multiverse"
#    DEBOOTSTRAPOPTS=("${DEBOOTSTRAPOPTS[@]}" "--keyring=/usr/share/keyrings/ubuntu-archive-keyring.gpg")
#else
#    echo "Unknown distribution: $DIST"
#    exit 1
#fi
#
# ubuntu specific configuration
case "$distribution" in
  utopic|trusty|precise)
    MIRRORSITE="http://$UBUNTU_MIRROR/ubuntu/"
    # we need key id 40976EAF437D05B5
    # cowdancer is in universe
    COMPONENTS="main universe"
    # package install speedup
    EXTRAPACKAGES="eatmydata"
    export LD_PRELOAD="${LD_PRELOAD:+$LD_PRELOAD:}/usr/lib/libeatmydata/libeatmydata.so"
    ;;
  lucid)
    # lacks eatmydata package, so explicitely configure it
    MIRRORSITE="http://$UBUNTU_MIRROR/ubuntu/"
    # we need key id 40976EAF437D05B5
    DEBOOTSTRAPOPTS=("${DEBOOTSTRAPOPTS[@]}" "--keyring=/usr/share/keyrings/ubuntu-archive-keyring.gpg")
    # cowdancer is in universe
    COMPONENTS="main universe"
    # lucid-updates required for libc6 bug
    OTHERMIRROR="$OTHERMIRROR | deb http://$UBUNTU_MIRROR/ubuntu/ lucid-updates $COMPONENTS"
    ;;
  squeeze|oldstable)
    # lacks eatmydata package, so explicitely configure it
    MIRRORSITE="http://$DEBIAN_MIRROR/debian/"
    # lacks debhelper 9, present in backports
    OTHERMIRROR="$OTHERMIRROR | deb http://$DEBIAN_BACKPORTS_MIRROR/debian-backports/ squeeze-backports $COMPONENTS"
    ;;
  *)
    MIRRORSITE="http://$DEBIAN_MIRROR/debian/"
    # package install speedup
    EXTRAPACKAGES="eatmydata"
    export LD_PRELOAD="${LD_PRELOAD:+$LD_PRELOAD:}/usr/lib/libeatmydata/libeatmydata.so"
    ;;
esac
