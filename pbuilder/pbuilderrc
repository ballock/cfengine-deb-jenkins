# Codenames for Debian suites according to their alias. Update these when
# needed.
UNSTABLE_CODENAME="sid"
TESTING_CODENAME="jessie"
STABLE_CODENAME="wheezy"
OLDSTABLE_CODENAME="squeeze"
OLDSTABLE_BACKPORTS_SUITE="$OLDSTABLE_CODENAME-backports"

# List of Debian suites.
DEBIAN_SUITES=($UNSTABLE_CODENAME $TESTING_CODENAME $STABLE_CODENAME $OLDSTABLE_CODENAME
    "unstable" "testing" "stable" "oldstable")

# List of Ubuntu suites. Update these when needed.
UBUNTU_SUITES=("utopic" "trusty" "saucy" "precise" "lucid")

# Mirrors to use. Update these to your preferred mirror.
if [ "$HOSTNAME"x = ballockx ]; then
  DEBIAN_MIRROR="debian.osuosl.org"
  UBUNTU_MIRROR="ubuntu.osuosl.org"
  DEBIAN_BACKPORTS_MIRROR=$DEBIAN_MIRROR
else
  DEBIAN_MIRROR="ftp.pl.debian.org"
  UBUNTU_MIRROR="pl.archive.ubuntu.com"
  DEBIAN_BACKPORTS_MIRROR="backports.debian.org"
fi

# Optionally use the changelog of a package to determine the suite to use if
# none set.
if [ -z "${DIST}" ] && [ -r "debian/changelog" ]; then
    DIST=$(dpkg-parsechangelog | awk '/^Distribution: / {print $2}')
    # Use the unstable suite for Debian experimental packages.
    if [ "${DIST}" == "experimental" ]; then
        DIST="unstable"
    fi
fi

case "$DIST" in
  vivid|utopic|trusty|precise|lucid)
    if [ "$ARCH"x = i386x -o "$ARCH"x = amd64x ]; then
      MIRRORSITE="http://$UBUNTU_MIRROR/ubuntu/"
    else
      MIRRORSITE="http://ports.ubuntu.com/"
    fi
    # we need key id 40976EAF437D05B5
    DEBOOTSTRAPOPTS=("${DEBOOTSTRAPOPTS[@]}" "--keyring=/usr/share/keyrings/ubuntu-archive-keyring.gpg")
    # cowdancer is in universe
    COMPONENTS="main universe"
    # package install speedup
    EXTRAPACKAGES="eatmydata"
    # updates for... precise openssl and lucid libc6 bug
    OTHERMIRROR="$OTHERMIRROR | deb $MIRRORSITE lucid-updates $COMPONENTS"
    export LD_PRELOAD="${LD_PRELOAD:+$LD_PRELOAD:}/usr/lib/libeatmydata/libeatmydata.so"
    ;;
#  lucid)
#    # lacks eatmydata package, so explicitely configure it
#    if [ "$ARCH"x = i386x -o "$ARCH"x = amd64x ]; then
#      MIRRORSITE="http://$UBUNTU_MIRROR/ubuntu/"
#    else
#      MIRRORSITE="http://ports.ubuntu.com/"
#    fi
#    # we need key id 40976EAF437D05B5
#    DEBOOTSTRAPOPTS=("${DEBOOTSTRAPOPTS[@]}" "--keyring=/usr/share/keyrings/ubuntu-archive-keyring.gpg")
#    # cowdancer is in universe
#    COMPONENTS="main universe"
#    # lucid-updates required for libc6 bug
#    OTHERMIRROR="$OTHERMIRROR | deb $MIRRORSITE lucid-updates $COMPONENTS"
#    ;;
  squeeze|oldstable)
    # lacks eatmydata package, so explicitely configure it
    MIRRORSITE="http://$DEBIAN_MIRROR/debian/"
    # lacks debhelper 9, present in backports
    OTHERMIRROR="$OTHERMIRROR | deb http://$DEBIAN_BACKPORTS_MIRROR/debian-backports/ squeeze-backports $COMPONENTS"
    ;;
  raspwheezy)
    MIRRORSITE="http://archive.raspbian.org/raspbian/"
    # package install speedup
    EXTRAPACKAGES="eatmydata"
    DEBOOTSTRAPOPTS=("${DEBOOTSTRAPOPTS[@]}" "--keyring=/usr/share/keyrings/raspbian-archive-keyring.gpg")
    export LD_PRELOAD="${LD_PRELOAD:+$LD_PRELOAD:}/usr/lib/libeatmydata/libeatmydata.so"
    export DIST=wheezy
    export distribution=wheezy
    APTCACHE="/var/cache/pbuilder/aptcache-raspberry/"
    ;;
  raspjessie)
    MIRRORSITE="http://archive.raspbian.org/raspbian/"
    # package install speedup
    EXTRAPACKAGES="eatmydata"
    DEBOOTSTRAPOPTS=("${DEBOOTSTRAPOPTS[@]}" "--keyring=/usr/share/keyrings/raspbian-archive-keyring.gpg")
    export LD_PRELOAD="${LD_PRELOAD:+$LD_PRELOAD:}/usr/lib/libeatmydata/libeatmydata.so"
    export DIST=jessie
    export distribution=jessie
    APTCACHE="/var/cache/pbuilder/aptcache-raspberry/"
    ;;
  *)
    MIRRORSITE="http://$DEBIAN_MIRROR/debian/"
    # package install speedup
    EXTRAPACKAGES="eatmydata"
    export LD_PRELOAD="${LD_PRELOAD:+$LD_PRELOAD:}/usr/lib/libeatmydata/libeatmydata.so"
    ;;
esac
